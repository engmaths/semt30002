<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Week 9: Linear programming – Scientific Computing and Optimisation</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-1713a1406d2974de726a81ab5f352b8f.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Scientific Computing and Optimisation</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../assessment.html"> 
<span class="menu-text">Assessment</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-coding" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Coding</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-coding">    
        <li>
    <a class="dropdown-item" href="../python/overview.html">
 <span class="dropdown-text">Overview</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../python/python_review.html">
 <span class="dropdown-text">Python recap</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../python/numpy.html">
 <span class="dropdown-text">NumPy, SciPy, Matplotlib</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../scicomp/timing_code.html">
 <span class="dropdown-text">Timing code</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-odes-and-pdes-(weeks-1–5" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">ODEs and PDEs (weeks 1–5)</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-odes-and-pdes-(weeks-1–5">    
        <li>
    <a class="dropdown-item" href="../scicomp/overview.html">
 <span class="dropdown-text">Overview</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../scicomp/week1.html">
 <span class="dropdown-text">Week 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../scicomp/week2.html">
 <span class="dropdown-text">Week 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../scicomp/week3.html">
 <span class="dropdown-text">Week 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../scicomp/week4.html">
 <span class="dropdown-text">Week 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../scicomp/week5.html">
 <span class="dropdown-text">Week 5</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-optimisation-(weeks-7–11" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Optimisation (weeks 7–11)</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-optimisation-(weeks-7–11">    
        <li>
    <a class="dropdown-item" href="../optim/overview.html">
 <span class="dropdown-text">Overview</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../optim/week7.html">
 <span class="dropdown-text">Week 7</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../optim/week8.html">
 <span class="dropdown-text">Week 8</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../optim/week9.html">
 <span class="dropdown-text">Week 9</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../optim/week10.html">
 <span class="dropdown-text">Week 10</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../optim/installing-pyomo.html">
 <span class="dropdown-text">Installing Pyomo</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#supplementary-material" id="toc-supplementary-material" class="nav-link active" data-scroll-target="#supplementary-material">Supplementary material</a></li>
  <li><a href="#exercise-1---a-simple-diet-problem" id="toc-exercise-1---a-simple-diet-problem" class="nav-link" data-scroll-target="#exercise-1---a-simple-diet-problem">Exercise 1 - a simple diet problem</a></li>
  <li><a href="#exercise-2---a-simple-diet-problem-extended" id="toc-exercise-2---a-simple-diet-problem-extended" class="nav-link" data-scroll-target="#exercise-2---a-simple-diet-problem-extended">Exercise 2 - a simple diet problem extended</a></li>
  <li><a href="#exercise-3---a-bigger-diet-problem" id="toc-exercise-3---a-bigger-diet-problem" class="nav-link" data-scroll-target="#exercise-3---a-bigger-diet-problem">Exercise 3 - a bigger diet problem</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Week 9: Linear programming</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In the following exercises you will learn the basics of Pyomo. Setting up a simple problem is relatively straightforward, but adding extra variables/constraints quickly becomes problematic if you don’t learn how to use its more advanced functionality.</p>
<p>These exercises will take you through setting up a basic problem with simple notation before moving to the more advanced functionality on the same problem. Finally, we will tackle a significantly larger problem requiring importing data.</p>
<section id="supplementary-material" class="level2">
<h2 class="anchored" data-anchor-id="supplementary-material">Supplementary material</h2>
<ul>
<li>Algorithms for Optimisation - <a href="https://algorithmsbook.com/optimization/files/chapter-11.pdf">Linear constrained optimization</a></li>
<li><a href="https://github.com/Pyomo/pyomo-tutorials/raw/main/Pyomo-Workshop-December-2023.pdf">Pyomo Workshop Slides</a> - slide 25 onwards in particular</li>
<li>Various linear programming implementations
<ul>
<li>Python - <a href="https://www.pyomo.org/">Pyomo</a></li>
<li>Julia - <a href="https://jump.dev/JuMP.jl/stable/">JuMP</a></li>
<li>MATLAB - <a href="https://uk.mathworks.com/help/optim/">Optimization Toolbox</a></li>
</ul></li>
</ul>
</section>
<section id="exercise-1---a-simple-diet-problem" class="level2">
<h2 class="anchored" data-anchor-id="exercise-1---a-simple-diet-problem">Exercise 1 - a simple diet problem</h2>
<p>The backdrop to this exercise is <a href="https://www.youtube.com/watch?v=36Uj1ZhWqa8" class="uri">https://www.youtube.com/watch?v=36Uj1ZhWqa8</a>; there is no need to watch the video unless you would like a reminder of how linear programming works.</p>
<p>In this exercise, a company would like to minimise the cost of “healthy” side dishes for their burgers. They have three basic ingredients: carrot, white cabbage, and pickled cucumbers.</p>
<p>The costs (per kg) of each of these ingredients are</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Ingredient</th>
<th style="text-align: right;">Cost</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Carrot</td>
<td style="text-align: right;">0.75</td>
</tr>
<tr class="even">
<td>Cabbage</td>
<td style="text-align: right;">0.50</td>
</tr>
<tr class="odd">
<td>Cucumber</td>
<td style="text-align: right;">0.15</td>
</tr>
</tbody>
</table>
<p>Their nutritional contents, with requirements per side dish, are</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Nutrition</th>
<th style="text-align: right;">Carrot</th>
<th style="text-align: right;">Cabbage</th>
<th style="text-align: right;">Cucumber</th>
<th style="text-align: right;">Requirement</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Vitamin A (mg/kg)</td>
<td style="text-align: right;">35</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.5</td>
<td style="text-align: right;">0.5mg</td>
</tr>
<tr class="even">
<td>Vitamin B (mg/kg)</td>
<td style="text-align: right;">60</td>
<td style="text-align: right;">300</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">15mg</td>
</tr>
<tr class="odd">
<td>Dietary Fibre (g/kg)</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">4g</td>
</tr>
</tbody>
</table>
<ol type="1">
<li>Create a model object to hold the problem. E.g., <code>pyo.ConcreteModel()</code>.</li>
<li>Create variables corresponding to each ingredient. E.g., <code>pyo.Var(within=pyo.NonNegativeReals)</code>.</li>
<li>Create an objective function to minimise the total cost. E.g., <code>pyo.Objective(expr=..., sense=pyo.minimize)</code>.</li>
<li>Create constraints for each of the nutritional requirements. E.g., <code>pyo.Constraint(expr=...)</code>.</li>
<li>Solve the linear program. E.g., <code>solver = pyo.SolverFactory('glpk') ; results = solver.solve(model, tee=True) ; model.pprint()</code>. Does the solution match that of the YouTube video (carrot = 9.5g, cabbage = 38g, cucumber = 294g)?</li>
<li>Let’s suppose that cucumbers aren’t available. There are a couple of ways we could achieve this - for example, we could rebuild with the third column removed. Alternatively, we could add an equality constraint on the problem (cucumber = 0).</li>
</ol>
</section>
<section id="exercise-2---a-simple-diet-problem-extended" class="level2">
<h2 class="anchored" data-anchor-id="exercise-2---a-simple-diet-problem-extended">Exercise 2 - a simple diet problem extended</h2>
<p>The goal with this exercise is to simplify the construction of the objective function and the constraints. Often data is provided in tableaus (as above) and instead of manually typing out constraints, we can use loops over the rows/columns of the table. This may not seem simpler for this small example, but it will be significantly easier for large problems.</p>
<ol type="1">
<li><p>Read slides 28-30 of the Pyomo Workshop Slides (link above; “Simple Modeling Example: Classic Knapsack Problem” onwards). How might you create a similar structure for the diet problem?</p></li>
<li><p>Use the variables (carrot, cabbage, cucumber) as the indices, with the cost and nutritional content as dictionaries (e.g., <code>cost = {'carrot': 0.75, ...}</code> and <code>vitaminA = {'carrot': 35}</code>). Create the full problem in Pyomo, solve it, and check your answer matches with exercise 1.</p></li>
<li><p>Using dictionaries, it was possible to simplify the problem so we have a single variable (with indices <code>['carrot', 'cabbage', 'cucumber']</code>), but all the constraints are still defined separately. To store all the constraint information in a single table, we can create a dictionary of the form <code>nutrition = {('carrot', 'vitamin A'): 35, ('carrot', 'vitamin B'): 60, ..., ('cucumber', 'fibre'): 10}</code>. Create a dictionary for the nutrition and a separate dictionary for the requirements.</p></li>
<li><p>Rather than give names to individual constraints, it is possible to create a list of constraints in Pyomo. This enables us to use loops to create many constraints easily. The form of the command is</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>model.constraints <span class="op">=</span> pyo.ConstraintList()</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> n <span class="kw">in</span> nutrient_names:</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>   model.constraints.add(...)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>How can you use this form to condense the creation of all the constraints? Solve the problem and check that your results match your previous results.</p>
<ul>
<li>Creating a dictionary by hand in this way is quite painful. We’d usually load one in from a spreadsheet directly - see the next exercise.</li>
</ul></li>
</ol>
</section>
<section id="exercise-3---a-bigger-diet-problem" class="level2">
<h2 class="anchored" data-anchor-id="exercise-3---a-bigger-diet-problem">Exercise 3 - a bigger diet problem</h2>
<p>In this problem, we have a much bigger and more realistic data set to work with. In this case you would not want to work by hand. Instead, we will use the approaches developed in exercise 2 to solve the problem.</p>
<ol type="1">
<li>Download the data files:
<ul>
<li><a href="https://raw.githubusercontent.com/engmaths/semt30002/b36da33fc3def9261f84e0a9340c262063383dff/optim/optim-09-lab-FoodContentsData.csv">optim-09-lab-FoodContentsData.csv</a></li>
<li><a href="https://raw.githubusercontent.com/engmaths/semt30002/b36da33fc3def9261f84e0a9340c262063383dff/optim/optim-09-lab-FoodPriceData.csv">optim-09-lab-FoodPriceData.csv</a></li>
<li><a href="https://raw.githubusercontent.com/engmaths/semt30002/b36da33fc3def9261f84e0a9340c262063383dff/optim/optim-09-lab-NutritionalRequirementsData.csv">optim-09-lab-NutritionalRequirementsData.csv</a></li>
</ul></li>
<li>Open each one in Excel (or similar) to familiarise yourself with the data.</li>
<li>Import <a href="https://pandas.pydata.org/">Pandas</a> to read the CSV files: <code>import pandas as pd</code>.</li>
<li>Load the data files using <code>data = pd.read_csv(filename, index_col=0)</code>.</li>
<li>The list of foods can be extracted from the food price data by taking the first column: <code>foods = prices.index.values.tolist()</code>. Similarly, the list of nutrient names can be taken from the first column of the nutritional requirements: <code>nutrient_names = requirements.index.values.tolist()</code>.</li>
<li>Convert the data files into dictionaries using <code>data_dict = data.stack().to_dict()</code>.</li>
<li>Set up your linear programming problem as in exercise 2 and solve it.
<ul>
<li>Note that there are both minimum and maximum nutritional requirements.</li>
</ul></li>
</ol>
<p>The solution that I get is:</p>
<pre class="text"><code>Frozen Broccoli  =  0.0
Carrots, Raw  =  0.257921686004706
Celery, Raw  =  0.0
Frozen Corn  =  0.0
Lettuce, Iceberg,Raw  =  0.0
Peppers, Sweet, Raw  =  0.0
Potatoes, Baked  =  6.11992356370029
Tofu  =  0.0
Roasted Chicken  =  0.0
Spaghetti W/ Sauce  =  0.0
Tomato,Red,Ripe,Raw  =  0.0
Apple, Raw, w/Skin  =  0.0
Banana  =  0.0
Grapes  =  0.0
Kiwifruit, Raw, Fresh  =  0.0
Oranges  =  0.0
Bagels  =  0.0
Wheat Bread  =  0.0
White Bread  =  0.0
Oatmeal Cookies  =  0.0
Apple Pie  =  0.0
Chocolate Chip Cookies  =  0.0
Butter, Regular  =  0.0
Cheddar Cheese  =  0.0
3.3% Fat, Whole Milk  =  0.0
2% Lowfat Milk  =  0.0
Skim Milk  =  2.00270396628937
Poached Eggs  =  0.0
Scrambled Eggs  =  0.0
Bologna, Turkey  =  0.0
Frankfurter, Beef  =  0.0
Ham, Sliced, Extralean  =  0.0
Kielbasa, Pork  =  0.0
Cap'N Crunch  =  0.0
Cheerios  =  0.0
Corn Flakes, Kellogg'S  =  0.0
Raisin Bran, Kellogg'S  =  0.0
Rice Krispies  =  0.0
Special K  =  0.0
Oatmeal  =  0.0
Malt-O-Meal, Choc  =  0.0
Pizza w/Pepperoni  =  0.0
Taco  =  0.0
Hamburger w/Toppings  =  0.0
Hotdog, Plain  =  0.0
Couscous  =  0.0
White Rice  =  0.117814898855647
Macaroni, cooked  =  0.0
Peanut Butter  =  3.92286261080103
Pork  =  0.0
Sardines in Oil  =  0.0
White Tuna in Water  =  0.0
Popcorn, Air-Popped  =  0.15278313277272
Potato Chips, BBQ  =  0.0
Pretzels  =  0.0
Tortilla Chips  =  0.0
Chicken Noodle Soup  =  0.0
Splt Pea&amp;Ham Soup  =  0.0
Veggie Beef Soup  =  0.0
New Eng Clam Chwd  =  0.0
Tomato Soup  =  0.0
New Eng Clam Chwd, w/Mlk  =  0.0
Crm Mshrm Soup, w/Mlk  =  0.0
Bean Bacon Soup, w/Watr  =  0.0</code></pre>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/engmaths\.github\.io\/semt30002\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>